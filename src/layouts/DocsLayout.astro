---
import { type CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import DocsSideBar from '../components/DocsSideBar.astro';
import DocsFooter from '../components/DocsFooter.astro';
import { Link } from '@components/typography';
import '@styles/pagefind.css';
import '@styles/color-theme.css';
import Button from '@react-ui/button/Button';
import DocsPagination from '../components/DocsPagination.astro';
import DocsHeader2 from '../components/DocsHeader2.astro';
import { BlurDivs } from '@components/utilities/DocsProgressiveBlur';
import { Text } from '@components/typography/Text';
import { Title } from '@components/typography/Title';
import { ArrowTopRightIcon } from '@radix-ui/react-icons';
import Search from '@components/Search';
import PageLoader from '@components/utilities/PageLoader.astro';
import { ViewTransitions } from 'astro:transitions';

type Props = CollectionEntry<'themer' | 'react'>;
const docs = Astro.props;
const { collection } = docs as Props;
const documentation = docs.data;
const { headings } = await docs.render();

const getGithubIssueUrl = (repo: string, template: string) => `https://github.com/Tailus-UI/${repo}/issues/new?assignees=&labels=&projects=&template=${template}&title=`;
const getGithubDiscussionUrl = (repo: string) => `https://github.com/Tailus-UI/${repo}/discussions/new/choose`;

const bugReportTemplate = '%F0%9F%90%9E-bug-report.md';
const newIdeasTemplate = '%F0%9F%92%A1-ideas-for-new-components--new-variants--examples--features-and-improvements-.md';
const repo = collection == 'themer' ? 'themer' : 'tailus-ui-react';
---

<script>
    const options = {
        root: null,
        threshold: 0,
        rootMargin: '0px'
    };

    document.addEventListener('astro:page-load', () => {
        const headings = document.querySelectorAll('h1, h2');
        const headingLinks = document.querySelectorAll("a[href^='#']");
        const headingIndicator = document.querySelector('#heading-indicator') as HTMLElement;

        const observer = new IntersectionObserver(function (entries) {
            entries.forEach(entry => {
                const { id } = entry.target;

                headingLinks.forEach(link => {
                    const href = link.getAttribute('href')?.replace('#', '');

                    if (href === id) {
                        const { classList } = link;

                        if (entry.isIntersecting) {
                            headingIndicator.style.top = `${(link as HTMLElement).offsetTop}px`;
                            headingIndicator.style.height = `${(link as HTMLElement).offsetHeight}px`;

                            classList.add('font-medium');
                            classList.replace('text-gray-600', 'text-gray-950');
                            classList.replace('dark:text-gray-400', 'dark:text-white');
                        } else {
                            classList.remove('font-medium');
                            classList.replace('text-gray-950', 'text-gray-600');
                            classList.replace('dark:text-white', 'dark:text-gray-400');
                        }
                    }
                });
            });
        }, options);

        headings.forEach(heading => {
            observer.observe(heading);
        });
    });
</script>

<html class="scroll-smooth dark" lang="en" data-palette="tls" data-rounded="xlarge">
    <head>
        <BaseHead title={`${documentation.title} - Tailus UI ${collection.charAt(0).toUpperCase() + collection.slice(1)}`} description={documentation.description} />
        <ViewTransitions />
        <script src="/pagefind/pagefind-ui.js" is:inline></script>
    </head>
    <body class="lg:overflow-hidden bg-white relative dark:bg-gray-925 lg:dark:bg-gray-900 font-sans antialiased leading-normal [--btn-radius:theme(borderRadius.lg)] dark:[--ui-border-color:theme(colors.gray.800)] selection:bg-info-600 selection:text-white dark:selection:bg-info-900 dark:selection:text-info-200 lg:before:fixed lg:before:inset-0 lg:before:-z-40 lg:dark:before:[background-image:url('/grainy-bg.svg')] lg:dark:before:opacity-[.015]">
        <div aria-hidden="true" class="lg:fixed blur-3xl -z-50 lg:-inset-56 lg:h-[200vh] origin-top-right rounded-bl-full scale-0 bg-gradient-to-b from-gray-200 opacity-0 dark:opacity-100 from-80% to-transparent transition-[transform,borderRadius] ease-[cubic-bezier(0.87,_0,_0.13,_1)] duration-1000 dark:scale-125 dark:from-gray-925"></div>
        <PageLoader />
        <DocsHeader2 />
        <main class="pt-20 lg:pt-0 lg:fixed lg:inset-x-0 lg:bottom-0 lg:w-screen lg:h-[calc(100vh-4rem)] lg:overflow-auto lg:mt-auto scroll-smooth" data-pagefind-body>
            <div class="px-8 lg:max-w-[76rem] xl:px-0 lg:mx-auto lg:flex lg:gap-24">
                <div id="menu-list" class="fixed bottom-0 w-full left-0 lg:left-auto lg:w-48 hidden h-[calc(100dvh-5.75rem)] lg:h-[calc(100dvh-4rem)] z-50 bg-white dark:bg-gray-925 lg:flex lg:flex-col lg:justify-end lg:bg-transparent dark:lg:bg-transparent" data-pagefind-ignore>
                    <DocsSideBar target={collection} />
                </div>
                <div class="w-full pt-12 lg:w-[calc(100%-17rem)] lg:ml-auto">
                    <div class="xl:flex xl:gap-16">
                        <div class="space-y-10 xl:w-[calc(100%-17rem)]">
                            <div>
                                <Title id="overview" size="2xl" className="sm:leading-none scroll-my-32">
                                    {documentation.title}
                                </Title>

                                <Text className="mt-6" size="lg">
                                    {documentation.description}
                                </Text>
                                <div class="flex gap-4 mt-4">
                                    {
                                        documentation.frameworkDocs && (
                                            <Link className="flex items-center group" target="_blank" intent="neutral" variant="underlined" href={documentation.frameworkDocs.link}>
                                                {documentation.frameworkDocs.name}
                                                <ArrowTopRightIcon className="size-3 ml-1 opacity-50 transition group-hover:-translate-y-0.5 group-hover:translate-x-0.5" />
                                            </Link>
                                        )
                                    }
                                    <!-- 
                  <Link
                    className="flex items-center group"
                    target="_blank"
                    intent="neutral"
                    variant="underlined"
                    href={`https://github.com/Tailus-UI/tailus-ui-react/tree/main/src/${docs.slug}`}
                  >
                    Source
                    <ArrowTopRightIcon
                      className="size-3 ml-1 opacity-50 transition group-hover:-translate-y-0.5 group-hover:translate-x-0.5"
                    />
                  </Link>
                  -->
                                </div>
                            </div>
                            <slot />
                            <DocsPagination data-pagefind-ignore page={docs} collection={collection} />
                            <div aria-hidden="true" class="h-0 lg:h-14 inset-x-0 fixed top-[3.3rem] lg:top-6 -translate-y-px mx-auto w-full pointer-events-none">
                                <BlurDivs />
                            </div>
                        </div>
                        <div data-pagefind-ignore id="table-of-content" class="hidden p-[--card-padding] fixed right-4 fancy-border feedback-shadow top-24 bg-[--ui-bg] z-50 ml-auto rounded-[--card-radius] size-fit xl:block lg:p-0 lg:h-fit lg:w-44 lg:sticky lg:top-12 lg:bg-transparent lg:!outline-none lg:!border-none lg:shadow-none lg:rounded-none">
                            <div class="text-sm text-gray-900 dark:text-white font-medium">On this page</div>
                            <div class="ml-px mt-3 relative w-fit h-fit max-h-[calc(100vh-26rem)] overflow-y-auto">
                                <div id="heading-indicator" aria-hidden="true" class="hidden lg:block absolute top-0 left-0 border-l-[1.5px] transition-all duration-300 border-gray-950 dark:border-white z-[1]"></div>
                                <ul class="relative border-l space-y-0.5">
                                    <li>
                                        <a href="#overview" class="text-xs flex items-center font-medium px-3.5 py-0.5 text-gray-600 dark:text-gray-400 hover:text-info-600 dark:hover:text-info-400 transition duration-300 rounded-2xl"> Overview</a>
                                    </li>
                                    {
                                        headings.map(heading => {
                                            if (heading.depth === 1 || heading.depth === 2) {
                                                return (
                                                    <li>
                                                        <a href={`#${heading.slug}`} class="text-xs flex items-center font-medium px-3.5 py-0.5 text-gray-600 dark:text-gray-400 hover:text-info-600 dark:hover:text-info-400 transition duration-300 rounded-2xl">
                                                            {heading.text}
                                                        </a>
                                                    </li>
                                                );
                                            }
                                        })
                                    }
                                </ul>
                            </div>

                            <div class="mt-6">
                                <div class="text-sm text-gray-900 dark:text-white font-medium">Contribute</div>
                                <div class="mt-2">
                                    <a href={getGithubIssueUrl(repo, bugReportTemplate)} class="flex items-center text-sm gap-2 py-1.5 text-gray-600 dark:text-gray-400 hover:text-gray-950 dark:hover:text-white transition duration-300">
                                        <svg class="size-[1.125rem]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                            ><g fill="none" stroke="currentColor" stroke-width="1.2"
                                                ><path
                                                    fill="currentColor"
                                                    fill-opacity=".25"
                                                    d="M7 14.333c0-1.246 0-1.869.268-2.333A2 2 0 0 1 8 11.268C8.464 11 9.087 11 10.333 11h3.334c1.246 0 1.869 0 2.333.268a2 2 0 0 1 .732.732c.268.464.268 1.087.268 2.333V16c0 .93 0 1.394-.077 1.78a4 4 0 0 1-3.143 3.143C13.394 21 12.93 21 12 21s-1.394 0-1.78-.077a4 4 0 0 1-3.143-3.143C7 17.394 7 16.93 7 16zM9 9c0-.932 0-1.398.152-1.765a2 2 0 0 1 1.083-1.083C10.602 6 11.068 6 12 6c.932 0 1.398 0 1.765.152a2 2 0 0 1 1.083 1.083C15 7.602 15 8.068 15 9v2H9z"
                                                ></path><path d="M12 11v4m3-12l-2 3M9 3l2 3M7 16H2m20 0h-5m3-7v1a3 3 0 0 1-3 3m3 9a3 3 0 0 0-3-3M4 9v1a3 3 0 0 0 3 3m-3 9a3 3 0 0 1 3-3"></path></g
                                            ></svg
                                        >
                                        Report a bug
                                    </a>
                                    <a href={getGithubIssueUrl(repo, newIdeasTemplate)} class="flex items-center text-sm gap-2 py-1.5 text-gray-600 dark:text-gray-400 hover:text-gray-950 dark:hover:text-white transition duration-300">
                                        <svg class="size-[1.125rem]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256"
                                            ><g fill="currentColor"
                                                ><path d="M208 104a79.86 79.86 0 0 1-30.59 62.92A24.29 24.29 0 0 0 168 186v6a8 8 0 0 1-8 8H96a8 8 0 0 1-8-8v-6a24.11 24.11 0 0 0-9.3-19A79.87 79.87 0 0 1 48 104.45C47.76 61.09 82.72 25 126.07 24A80 80 0 0 1 208 104" opacity=".2"></path><path
                                                    d="M176 232a8 8 0 0 1-8 8H88a8 8 0 0 1 0-16h80a8 8 0 0 1 8 8m40-128a87.55 87.55 0 0 1-33.64 69.21A16.24 16.24 0 0 0 176 186v6a16 16 0 0 1-16 16H96a16 16 0 0 1-16-16v-6a16 16 0 0 0-6.23-12.66A87.59 87.59 0 0 1 40 104.5c-.26-47.67 38.26-87.35 85.88-88.5A88 88 0 0 1 216 104m-16 0a72 72 0 0 0-73.74-72c-39 .92-70.47 33.39-70.26 72.39a71.64 71.64 0 0 0 27.64 56.3A32 32 0 0 1 96 186v6h24v-44.69l-29.66-29.65a8 8 0 0 1 11.32-11.32L128 132.69l26.34-26.35a8 8 0 0 1 11.32 11.32L136 147.31V192h24v-6a32.12 32.12 0 0 1 12.47-25.35A71.65 71.65 0 0 0 200 104"
                                                ></path></g
                                            ></svg
                                        >
                                        New Ideas
                                    </a>

                                    <div class="mt-3">
                                        <Button.Root className="w-fit" variant="outlined" intent="gray" href={getGithubDiscussionUrl(repo)} size="sm">
                                            <Button.Label>Start a discussion</Button.Label>
                                        </Button.Root>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <DocsFooter />
                </div>
            </div>
        </main>
        <Search client:load>
            <div id="search"></div>
        </Search>
    </body>
</html>
